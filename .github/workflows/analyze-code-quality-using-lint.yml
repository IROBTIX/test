name: PR Checks

on:
  pull_request:
    types:
      - opened
      - synchronize
  push:
    branches:
      - '**'  # This triggers on pushes to any branch

jobs:
  lint-detekt:
    name: Run Lint and Detekt
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'  # Match your projectâ€™s JDK

      - name: Grant execute permission for Gradle
        run: chmod +x ./gradlew

      # Get the list of modified files and store it in a variable
      - name: Get modified files
        id: modified-files
        run: |
          echo "$(git diff --name-only HEAD^ HEAD)" >> modified_files.txt
          echo "::set-output name=files::$(cat modified_files.txt)"

      # Run Android Lint only on modified files
      - name: Run Android Lint on modified files
        run: |
          MODIFIED_FILES=$(cat modified_files.txt | grep '\.kt$' || echo "") 
          if [ ! -z "$MODIFIED_FILES" ]; then 
            ./gradlew lint --continue
          else
            echo "No Kotlin files modified. Skipping Lint."
          fi

      # Run Detekt only on modified files
      - name: Run Detekt on modified files
        run: |
          MODIFIED_FILES=$(cat modified_files.txt | grep '\.kt$' || echo "") 
          if [ ! -z "$MODIFIED_FILES" ]; then 
            ./gradlew detekt --continue
          else
            echo "No Kotlin files modified. Skipping Detekt."
          fi
